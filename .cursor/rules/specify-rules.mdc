# sdg-application Development Guidelines

Auto-generated from all feature plans. Last updated: 2025-11-07

> **Note**: This file is auto-generated from feature plans. For comprehensive development guidelines, see [`AGENTS.md`](../../AGENTS.md).

## Active Technologies
- TypeScript 5.7.2, Node.js >=20.0.0 + Next.js 15.5.9, React 19.0.1, React Hook Form 7.54.1, Zod 3.24.4, TanStack Query 5.90.10, Supabase 2.45.4 (024-refactor-supplier)
- PostgreSQL (via Supabase) - companies table, clients_suppliers table (024-refactor-supplier)
- TypeScript 5.7+ (strict mode), React 19, Next.js 15 + Next.js 15 App Router, React 19 Server Components, TanStack Query, React Hook Form, Zod, Supabase Client (024-refactor-supplier)
- Supabase PostgreSQL (remote database is single source of truth) (024-refactor-supplier)
- TypeScript 5.7+ (strict mode) + Next.js 15, React 19, Radix UI, Tailwind CSS v4, class-variance-authority (025-supplier-detail-refresh)
- Supabase (existing, no changes) (025-supplier-detail-refresh)
- TypeScript 5.7+ (strict mode), Next.js 15, React 19 + Next.js 15 App Router, React 19 Server Components, Supabase (PostgreSQL), Zod validation, TanStack Query, React Hook Form (027-profile-management)
- Supabase PostgreSQL (profiles table, clients_suppliers table) (027-profile-management)

### Core Framework & Runtime
- **TypeScript**: 5.7.2 (strict mode)
- **Node.js**: >=20.0.0 (via Next.js) - **MUST match package.json engines requirement**
- **Next.js**: 15.5.9
- **React**: 19.0.1
- **React DOM**: 19.0.1

### UI & Styling
- **Tailwind CSS**: v4 (with OKLCH color space)
- **PostCSS**: 8.4.49
- **ReUI Components**: Via `@reui/*` registry (preferred for new components)
- **shadcn/ui**: Legacy components (migrate to ReUI when possible)
- **Radix UI**: Base component primitives
- **Remix Icon**: @remixicon/react 4.7.0
- **Lucide React**: 0.476.0

### Form Handling & Validation
- **React Hook Form**: 7.54.1
- **Zod**: 3.24.4 (**MANDATORY for all external data validation**)
- **@hookform/resolvers**: 5.2.1

### State Management & Data Fetching
- **TanStack Query**: 5.90.10 (for server state)
- **TanStack Table**: 8.21.3 (for data grids)
- **TanStack Virtual**: 3.13.12 (for virtualization)
- **Zustand**: 5.0.2 (for global state when needed)
- **nuqs**: 2.4.1 (for URL state management)

### Database & Backend
- **Supabase**: 2.45.4 (PostgreSQL database)
- **Supabase SSR**: 0.7.0 (for Next.js integration)
- **PostgreSQL**: Via Supabase (primary database)

### File Handling
- **react-dropzone**: 14.3.5 (for file uploads)
- **PapaParse**: 5.5.3 (for CSV parsing)
- **Sharp**: 0.33.5 (for image processing)

### Development Tools
- **Storybook**: 9.1.16 (with @storybook/nextjs-vite)
- **Vite**: 5+ (for Storybook)
- **Vitest**: 4.0.8 (for testing)
- **ESLint**: 9 (with Next.js config)
- **Prettier**: 3.4.2
- **TypeScript ESLint**: 8.46.1

### Monitoring & Error Tracking
- **Sentry**: 10.14.0 (@sentry/nextjs)

### AI & Assistance
- **CopilotKit**: 1.9.3 (AI assistance features)

### Other Key Libraries
- **date-fns**: 3.6.0 (date utilities)
- **class-variance-authority**: 0.7.1 (component variants)
- **clsx**: 2.1.1 (conditional classes)
- **tailwind-merge**: 3.0.2 (Tailwind class merging)
- **next-themes**: 0.4.6 (theme management)
- **recharts**: 2.15.1 (charts)

## Database Tables

### Core Tables
- `companies` - Company data
- `clients_suppliers` - Supplier relationships
- `auth.users` - Supabase authentication users
- `profiles` - User profiles

### Assessment Tables
- `maturity_assessments` - Maturity assessment data
- `materiality_assessments` - Materiality assessments
- `influence_assessments` - Influence assessments
- `engagement_assessments` - Engagement assessments
- `opportunities_assessments` - Opportunities assessments

### Survey Tables
- `supplier_surveys` - Survey definitions
- `survey_responses` - Survey responses

### Other Tables
- `interviews` - Interview records

### Storage Buckets
- `interviews` - Transcript files (Supabase Storage)
- Avatars (Supabase Storage) - User profile images

## Project Structure

```text
src/
├── app/                    # Next.js App Router
├── components/             # Shared UI components
│   ├── ui/                # Base components (shadcn/ui legacy)
│   └── common/            # Application-specific shared components
├── features/              # Feature-based modules (RECOMMENDED)
│   └── [feature]/
│       ├── __tests__/     # Co-located tests
│       ├── components/    # Feature components
│       ├── hooks/         # Feature-specific hooks
│       ├── api/           # API integration
│       ├── schemas/       # Zod validation schemas
│       ├── types/         # TypeScript types
│       └── index.ts        # Public API
├── lib/                   # Core utilities and configurations
├── hooks/                 # Shared custom hooks
└── types/                 # Shared TypeScript types

tests/                     # Test utilities and setup
supabase/                  # Database migrations and config
```

## Commands

**⚠️ CRITICAL: Always use `pnpm` instead of `npm` or `yarn`**

```bash
# Development
pnpm run dev              # Start development server
pnpm run dev:ui           # UI only
pnpm run dev:agent        # Agent only

# Quality Checks
pnpm run type-check       # TypeScript validation
pnpm run lint             # ESLint
pnpm run lint:fix         # Fix linting issues
pnpm run format           # Prettier formatting
pnpm run validate         # Run all checks (type-check + lint + test:coverage)

# Testing
pnpm test                 # Run tests
pnpm test:watch          # Watch mode
pnpm test:coverage        # Coverage report (minimum 80% required)
pnpm test:ui              # Test UI

# Build & Deploy
pnpm run build            # Production build
pnpm run start            # Start production server

# Storybook
pnpm run storybook        # Start Storybook
pnpm run build-storybook  # Build Storybook
```

## Code Style

- **TypeScript**: 5.7.2 (strict mode)
- **Node.js**: >=20.0.0 (matches package.json engines requirement)
- **Package Manager**: pnpm (MANDATORY - never use npm or yarn)
- **Search Commands**: Always use `rg` (ripgrep) instead of `grep` or `find` (see AGENTS.md)
- **Linting**: ESLint with Next.js config, zero warnings required
- **Formatting**: Prettier with Tailwind plugin
- **Testing**: Vitest with React Testing Library, minimum 80% coverage

### TypeScript Requirements
- **NEVER use `any` type** - use `unknown` if type is truly unknown
- **MUST have explicit return types** for all functions and components
- **MUST use `ReactElement`** instead of `JSX.Element` for component return types
- **MUST use type inference from Zod schemas** using `z.infer<typeof schema>`
- **NEVER use `@ts-ignore`** or `@ts-expect-error` - fix the type issue properly

### Validation Requirements
- **MUST validate ALL external data** with Zod (API responses, form inputs, URL params, environment variables)
- **MUST use branded types** for all IDs and domain-specific values
- **MUST fail fast** - validate at system boundaries, throw errors immediately

## Feature-Specific Technology References

### Supplier Management
- **002-bulk-supplier-import**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, Supabase PostgreSQL
- **002-supplier-index**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, ReUI data grid, TanStack Query, TanStack Table, Zod, nuqs
- **003-bulk-supplier-import**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, react-dropzone, PapaParse, Zod, TanStack Query, Supabase
- **023-refactor-supplier-import**: TypeScript 5.7.2 (strict mode), Node.js 20+, Next.js 15.5.9, PostgreSQL (Supabase)

### Assessment & Survey Features
- **001-supplier-maturity-questionnaire**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, Zod, Supabase PostgreSQL, React Hook Form
- **004-supplier-maturity-survey**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, React Hook Form, Zod, TanStack Query, ReUI components, Supabase PostgreSQL
- **005-supplier-maturity-survey**: TypeScript 5.7.2, Next.js 15.5.9, React 19.0.1
- **006-assessment-scorecard**: TypeScript 5.7.2, React 19.0.1, Next.js 15.5.9, Supabase PostgreSQL
- **010-maturity-assessment-categories**: TypeScript 5.7.2, Next.js 15.5.9, React 19.0.1, Zod, Supabase PostgreSQL
- **018-assessment-scorecards**: TypeScript 5.7.2, Supabase PostgreSQL
- **021-assessment-management**: TypeScript 5.7.2 (strict mode), Next.js 15.5.9, React 19.0.1, TanStack Query, Zod, Supabase PostgreSQL

### Authentication & User Management
- **003-supabase-auth**: Supabase PostgreSQL (auth.users, profiles), Supabase Storage (avatars)
- **016-superadmin-user-management**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, Supabase, Zod, TanStack Query, React Hook Form

### Company Management
- **011-company-data-enrichment**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, TanStack Query, Zod, Supabase PostgreSQL, external Modal.run API
- **017-companies-crud**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, React Hook Form, Zod, TanStack Query, Supabase

### API Proxies
- **012-import-api-proxy**: TypeScript 5.7.2, Next.js 15.5.9, React 19.0.1, Zod, TanStack Query, external API (handles database operations)
- **013-suppliers-list-api-proxy**: TypeScript 5.7.2, Next.js 15.5.9, React 19.0.1, Zod, TanStack Query (infinite pagination)
- **014-supplier-detail-api-proxy**: TypeScript 5.7.2, Next.js 15.5.9, React 19.0.1, Zod, TanStack Query, Supabase Auth, Sentry, external API (FastAPI/Modal)

### UI & Design
- **020-theme-brand-colors**: TypeScript 5.7.2 (strict mode), Next.js 15.5.9, React 19.0.1, Tailwind CSS v4, OKLCH color space, CSS variables, cookie-based theme persistence
- **008-reusable-pie-chart**: Client-side component, no persistent storage
- **008-copilotkit-assistance**: Supabase PostgreSQL (user data), session-based chat (in-memory, not persisted), CopilotKit

### Development Tools
- **001-storybook-setup**: TypeScript 5.7.2, JavaScript (ES2022+), Next.js 15.5.9, React 19.0.1, Storybook (@storybook/nextjs-vite), Vite 5+
- **026-test-status-page**: TypeScript 5.7.2 (strict mode), Next.js 15.5.9, React 19.0.1, Next.js App Router, React Server/Client Components, TanStack Query, Supabase Client, Zod validation, Supabase PostgreSQL (database functions: `get_company_status`, `get_supplier_status`)

### Interviews
- **001-interviews-crud**: TypeScript 5.7.2, Node.js 20+, Next.js 15.5.9, React 19.0.1, React Hook Form, Zod, TanStack Query, Supabase, react-dropzone, Supabase Storage (interviews bucket)

## Recent Changes
- 027-profile-management: Added TypeScript 5.7+ (strict mode), Next.js 15, React 19 + Next.js 15 App Router, React 19 Server Components, Supabase (PostgreSQL), Zod validation, TanStack Query, React Hook Form
- 026-test-status-page: Added TypeScript 5.7.2 (strict mode), Next.js 15.5.9, React 19.0.1, Next.js App Router, React Server/Client Components, TanStack Query, Supabase Client, Zod validation, Supabase PostgreSQL (database functions: `get_company_status`, `get_supplier_status`)
- 025-supplier-detail-refresh: Added TypeScript 5.7+ (strict mode) + Next.js 15, React 19, Radix UI, Tailwind CSS v4, class-variance-authority

## Contradictions Resolved

### Version Standardization
- ✅ All Node.js references updated to `>=20.0.0` (matches package.json)
- ✅ All Next.js references standardized to `15.5.9` (current version)
- ✅ All React references standardized to `19.0.1` (current version)
- ✅ All TypeScript references standardized to `5.7.2` (current version)

### Package Manager
- ✅ Changed `npm` to `pnpm` in Commands section (matches AGENTS.md requirement)

### Duplicate Entries
- ✅ Consolidated duplicate entries for `001-supplier-index` and `002-supplier-index`

### Structure Improvements
- ✅ Expanded Project Structure section with detailed directory layout
- ✅ Expanded Code Style section with key requirements from AGENTS.md
- ✅ Separated database entries into dedicated "Database Tables" section
- ✅ Organized technologies by category for better readability
- ✅ Added missing technologies (Tailwind v4, Storybook, Sentry, CopilotKit)
- ✅ Fixed truncated text ("Supabase Clien" → "Supabase Client")
- ✅ Removed duplicate Recent Changes entry
- ✅ Added search command requirements (rg vs grep/find)
- ✅ Added reference to AGENTS.md for comprehensive guidelines

<!-- MANUAL ADDITIONS START -->
<!-- MANUAL ADDITIONS END -->
